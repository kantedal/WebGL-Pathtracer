<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>WebGL Pathtracer</title>
  <base href="/">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Permanent+Marker" rel="stylesheet">

</head>
<body style="margin: 0px; background-color: #fafafa;">
  <script src="./lib/gl-matrix.js"></script>
  <script src="./lib/jquery.min.js"></script>
  <script src="./lib/circle-progress.min.js"></script>
  <script id="vs_render" type="x-shader/vertex">
    attribute vec3 vertex;
    varying vec2 texCoord;
    void main() {
      texCoord = vertex.xy * 0.5 + 0.5;
      gl_Position = vec4(vertex, 1.0);
    }
  </script>

  <script id="fs_render" type="x-shader/fragment">
    precision highp float;
    uniform float samples;
    varying vec2 texCoord;

    //uniform sampler2D u_textures[2];

    uniform sampler2D u_bloom_text;
    uniform sampler2D u_buffer_text;

    void main() {
      vec3 color = vec3(texture2D(u_buffer_text, texCoord));

      color = vec3(
        pow(clamp(color.x, 0.0, 1.0), 0.7),
        pow(clamp(color.y, 0.0, 1.0), 0.7),
        pow(clamp(color.z, 0.0, 1.0), 0.7)
      );

      gl_FragColor = vec4(color, 1.0);
    }
  </script>

  <script id="fs_combine" type="x-shader/fragment">
    precision highp float;
    uniform float samples;
    varying vec2 texCoord;
    uniform sampler2D u_bloom_text;
    uniform sampler2D u_buffer_text;

    void main() {
      vec3 color = vec3(texture2D(u_bloom_text, texCoord));
      gl_FragColor = vec4(color, 1.0);
    }
  </script>

  <script id="vs" type="x-shader/vertex">
    attribute vec3 vertex;
    varying vec2 texCoord;
    void main() {
      texCoord = vertex.xy * 0.5 + 0.5;
      gl_Position = vec4(vertex, 1.0);
    }
  </script>

  <script id="horizontal-blur" type="x-shader/fragment">
    precision highp float;
    varying vec2 texCoord;
    uniform sampler2D u_buffer_texture;

    void main() {
      vec3 color = vec3(0.0, 0.0, 0.0);
      for (float x = -3.0; x < 3.0; x += 1.0) {
        color += vec3(texture2D(u_buffer_texture, texCoord + vec2(x / 512.0, 0))) * 1.0 / 3.0;
      }
      gl_FragColor = vec4(color, 1.0);
    }
  </script>

  <script id="vertical-blur" type="x-shader/fragment">
    precision highp float;
    varying vec2 texCoord;
    uniform sampler2D u_buffer_texture;

    void main() {
      vec3 color = vec3(0.0, 0.0, 0.0);
      for (float y = -3.0; y < 3.0; y += 1.0) {
        color += vec3(texture2D(u_buffer_texture, texCoord + vec2(0, y / 512.0))) * 1.0 / 3.0;
      }
      gl_FragColor = vec4(color, 1.0);
    }
  </script>

  <script id="threshold" type="x-shader/fragment">
    precision highp float;
    varying vec2 texCoord;
    uniform float samples;
    uniform sampler2D u_buffer_texture;

    void main() {
      vec3 color = vec3(texture2D(u_buffer_texture, texCoord)) * 1.0 / samples;

      if (color.r < 1.0) color.r = 0.0;
      if (color.g < 1.0) color.g = 0.0;
      if (color.b < 1.0) color.b = 0.0;

      gl_FragColor = vec4(color, 1.0);
    }
  </script>

  <app-root>Loading...</app-root>
</body>
</html>
